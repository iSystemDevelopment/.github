name: 'Secret Scanning Alert Notification'

on:
  secret_scanning_alert:
    types: [created, reopened]

permissions:
  contents: read
  security-events: read
  issues: write

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Create Issue for Secret Alert
        uses: actions/github-script@v7
        with:
          script: |
            const alert = context.payload.alert;
            const repository = context.payload.repository.full_name;
            
            const title = `ðŸ”’ Secret Scanning Alert: ${alert.secret_type}`;
            const body = `
            ## Secret Scanning Alert
            
            A secret has been detected in the repository.
            
            **Repository:** ${repository}
            **Secret Type:** ${alert.secret_type}
            **Alert URL:** ${alert.html_url}
            **State:** ${alert.state}
            
            ### Action Required
            
            1. **Immediately revoke** the exposed secret
            2. **Remove** the secret from the repository history
            3. **Update** all systems using this secret
            4. **Investigate** how the secret was exposed
            5. **Review** commit history to ensure no other secrets are exposed
            
            ### Best Practices
            
            - Use environment variables for secrets
            - Use GitHub Secrets for CI/CD workflows
            - Use secret management tools (e.g., HashiCorp Vault, AWS Secrets Manager)
            - Never commit secrets to version control
            - Use .gitignore to exclude files containing secrets
            - Enable pre-commit hooks to scan for secrets locally
            
            **This issue was automatically created by the Secret Scanning Alert workflow.**
            `;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['security', 'secret-scanning', 'urgent']
            });
